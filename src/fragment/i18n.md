# ğŸŒ åœ¨ React ä¸­å®ç°å›½é™…åŒ–ï¼šåŸºäº i18next çš„å®Œæ•´æ–¹æ¡ˆ

## ğŸ” ä»‹ç»

æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»å¦‚ä½•åœ¨ React é¡¹ç›®ä¸­å®ç°å®Œå–„çš„å›½é™…åŒ–è§£å†³æ–¹æ¡ˆï¼ŒåŒ…æ‹¬è¯­è¨€æ£€æµ‹ã€åˆ‡æ¢ã€æŒä¹…åŒ–å’Œé«˜çº§æ ¼å¼åŒ–åŠŸèƒ½ã€‚å›½é™…åŒ–ï¼ˆi18nï¼‰æ˜¯ä½¿åº”ç”¨èƒ½å¤Ÿé€‚åº”ä¸åŒè¯­è¨€å’Œåœ°åŒºçš„è¿‡ç¨‹ï¼Œæ˜¯æ‹“å±•å…¨çƒç”¨æˆ·å¸‚åœºçš„å…³é”®æ­¥éª¤ã€‚

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

æœ¬é¡¹ç›®ä½¿ç”¨çš„å›½é™…åŒ–ç›¸å…³æŠ€æœ¯æ ˆï¼š

| åº“                                   | ç”¨é€”                              | ç‰ˆæœ¬     |
| ------------------------------------ | --------------------------------- | -------- |
| **i18next**                          | æ ¸å¿ƒå›½é™…åŒ–æ¡†æ¶                    | ^21.8.0  |
| **react-i18next**                    | React ç»‘å®šåº“                      | ^11.16.0 |
| **i18next-browser-languagedetector** | è‡ªåŠ¨æ£€æµ‹æµè§ˆå™¨è¯­è¨€                | ^6.1.4   |
| **i18next-icu**                      | æ”¯æŒ ICU æ¶ˆæ¯æ ¼å¼ï¼ˆå¤æ•°ã€æ€§åˆ«ç­‰ï¼‰ | ^2.0.3   |
| **i18next-http-backend**             | åŠ¨æ€åŠ è½½ç¿»è¯‘æ–‡ä»¶                  | ^1.4.0   |

## ğŸ“‚ é¡¹ç›®ç»“æ„

å›½é™…åŒ–ç›¸å…³æ–‡ä»¶ç»„ç»‡ï¼š

```
src/
  â””â”€â”€ i18n/
      â”œâ”€â”€ index.ts                # i18next é…ç½®æ–‡ä»¶
      â”œâ”€â”€ locales/                # ç¿»è¯‘èµ„æºç›®å½•
      â”‚   â”œâ”€â”€ en-US/              # è‹±æ–‡èµ„æº
      â”‚   â”‚   â”œâ”€â”€ common.json     # é€šç”¨ç¿»è¯‘
      â”‚   â”‚   â”œâ”€â”€ home.json       # é¦–é¡µç¿»è¯‘
      â”‚   â”‚   â””â”€â”€ user.json       # ç”¨æˆ·ç›¸å…³ç¿»è¯‘
      â”‚   â””â”€â”€ zh-CN/              # ä¸­æ–‡èµ„æº
      â”‚       â”œâ”€â”€ common.json     # é€šç”¨ç¿»è¯‘
      â”‚       â”œâ”€â”€ home.json       # é¦–é¡µç¿»è¯‘
      â”‚       â””â”€â”€ user.json       # ç”¨æˆ·ç›¸å…³ç¿»è¯‘
      â””â”€â”€ types.ts                # ç±»å‹å®šä¹‰ï¼ˆTypeScriptï¼‰
```

## âš™ï¸ æ ¸å¿ƒé…ç½®

`i18n/index.ts` æ–‡ä»¶æ˜¯å›½é™…åŒ–çš„æ ¸å¿ƒé…ç½®ï¼š

```typescript
import i18n from 'i18next';
import { initReactI18next } from 'react-i18next';
import ICU from 'i18next-icu';
import LanguageDetector from 'i18next-browser-languagedetector';
import Backend from 'i18next-http-backend';

// å¯¼å…¥ç¿»è¯‘èµ„æº
import enCommon from './locales/en-US/common.json';
import enHome from './locales/en-US/home.json';
import zhCommon from './locales/zh-CN/common.json';
import zhHome from './locales/zh-CN/home.json';

i18n
  // åŠ¨æ€åŠ è½½ç¿»è¯‘
  .use(Backend)
  // è‡ªåŠ¨æ£€æµ‹ç”¨æˆ·è¯­è¨€
  .use(LanguageDetector)
  // æ”¯æŒICUæ ¼å¼
  .use(new ICU())
  // é›†æˆReact
  .use(initReactI18next)
  .init({
    // é¢„åŠ è½½èµ„æº
    resources: {
      'en-US': {
        common: enCommon,
        home: enHome,
      },
      'zh-CN': {
        common: zhCommon,
        home: zhHome,
      },
    },
    // é»˜è®¤å‘½åç©ºé—´
    defaultNS: 'common',
    // Reactå·²ç»é˜²æ­¢XSS
    interpolation: {
      escapeValue: false,
    },
    // å›é€€è¯­è¨€
    fallbackLng: 'en-US',
    // æ”¯æŒçš„è¯­è¨€åˆ—è¡¨
    supportedLngs: ['en-US', 'zh-CN'],
    // è¯­è¨€æ£€æµ‹é…ç½®
    detection: {
      // æ£€æµ‹é¡ºåº
      order: ['querystring', 'cookie', 'localStorage', 'navigator'],
      // URLå‚æ•°å
      lookupQuerystring: 'locale',
      // Cookieå
      lookupCookie: 'locale',
      // localStorageé”®å
      lookupLocalStorage: 'locale',
      // ç¼“å­˜ä½ç½®
      caches: ['cookie', 'localStorage'],
      // Cookieé€‰é¡¹
      cookieOptions: {
        path: '/',
        sameSite: 'strict',
        expires: 365,
      },
    },
    // è°ƒè¯•æ¨¡å¼ï¼ˆç”Ÿäº§ç¯å¢ƒåº”å…³é—­ï¼‰
    debug: process.env.NODE_ENV === 'development',
  });

export default i18n;
```

## ğŸ“ ç¿»è¯‘èµ„æºæ–‡ä»¶

ç¿»è¯‘èµ„æºé‡‡ç”¨ JSON æ ¼å¼ï¼ŒæŒ‰å‘½åç©ºé—´ç»„ç»‡ï¼š

**locales/en-US/common.json**:

```json
{
  "welcome": "Welcome",
  "message": "Hello",
  "buttons": {
    "save": "Save",
    "cancel": "Cancel",
    "delete": "Delete"
  },
  "errors": {
    "required": "This field is required",
    "invalid": "Invalid value"
  }
}
```

**locales/en-US/home.json**:

```json
{
  "title": "Home",
  "subtitle": "Welcome to our application",
  "item": "{count, plural, =0 {no projects} one {# project} other {# projects}}",
  "genderSentence": "{gender, select, male {He avoids bugs.} female {She avoids bugs.} other {They avoid bugs.}}",
  "dateFormat": "Last updated on {date, date, medium}"
}
```

## ğŸ§© åœ¨ç»„ä»¶ä¸­ä½¿ç”¨

### åŸºæœ¬ç¿»è¯‘

```jsx
import { useTranslation } from 'react-i18next';

function WelcomeComponent() {
  const { t } = useTranslation(['common', 'home']);

  return (
    <div>
      <h1>{t('common:welcome')}</h1>
      <p>{t('home:subtitle')}</p>
      <button>{t('common:buttons.save')}</button>
    </div>
  );
}
```

### é«˜çº§æ ¼å¼åŒ–

æ”¯æŒ ICU æ¶ˆæ¯æ ¼å¼ï¼ŒåŒ…æ‹¬ï¼š

1. **å¤æ•°å½¢å¼**:

```jsx
function ProjectList({ count }) {
  const { t } = useTranslation('home');

  return (
    <div>
      <h2>{t('title')}</h2>
      <p>{t('item', { count })}</p>
    </div>
  );
}

// è¾“å‡ºç¤ºä¾‹:
// count=0: "no projects"
// count=1: "1 project"
// count=5: "5 projects"
```

2. **æ€§åˆ«é€‰æ‹©**:

```jsx
function DeveloperInfo({ developer }) {
  const { t } = useTranslation('home');

  return (
    <div>
      <h3>{developer.name}</h3>
      <p>{t('genderSentence', { gender: developer.gender })}</p>
    </div>
  );
}

// è¾“å‡ºç¤ºä¾‹:
// gender="male": "He avoids bugs."
// gender="female": "She avoids bugs."
// gender="other": "They avoid bugs."
```

3. **æ—¥æœŸæ ¼å¼åŒ–**:

```jsx
function LastUpdated({ date }) {
  const { t } = useTranslation('home');

  return (
    <div>
      <p>{t('dateFormat', { date: new Date(date) })}</p>
    </div>
  );
}

// è¾“å‡ºç¤ºä¾‹: "Last updated on Feb 18, 2023"
```

## ğŸ”„ è¯­è¨€åˆ‡æ¢å®ç°

æœ¬é¡¹ç›®ä½¿ç”¨ URL æŸ¥è¯¢å‚æ•°æ¥å®ç°è¯­è¨€åˆ‡æ¢ï¼ŒåŒæ—¶ä¹Ÿä¿å­˜åœ¨ localStorage å’Œ cookie ä¸­ï¼š

```jsx
import { useTranslation } from 'react-i18next';
import { useNavigate, useLocation } from 'react-router-dom';
import { useCallback, useEffect } from 'react';

function LanguageSwitcher() {
  const { i18n } = useTranslation();
  const navigate = useNavigate();
  const location = useLocation();

  // åˆ‡æ¢è¯­è¨€å‡½æ•°
  const handleChangeLocale = useCallback(
    (locale) => {
      const params = new URLSearchParams(location.search);
      params.set('locale', locale);
      navigate({ search: params.toString() }, { replace: true });
      document.documentElement.lang = locale; // æ›´æ–°HTML langå±æ€§
    },
    [navigate, location.search]
  );

  // ä»URLåŒæ­¥è¯­è¨€è®¾ç½®
  useEffect(() => {
    const params = new URLSearchParams(location.search);
    const locale = params.get('locale');

    if (locale && locale !== i18n.language) {
      i18n.changeLanguage(locale);
    } else if (!locale && i18n.language) {
      handleChangeLocale(i18n.language);
    }
  }, [location.search, i18n, handleChangeLocale]);

  return (
    <div className="language-switcher">
      <button
        className={i18n.language === 'zh-CN' ? 'active' : ''}
        onClick={() => handleChangeLocale('zh-CN')}
      >
        ä¸­æ–‡
      </button>
      <button
        className={i18n.language === 'en-US' ? 'active' : ''}
        onClick={() => handleChangeLocale('en-US')}
      >
        English
      </button>
      <span>å½“å‰è¯­è¨€: {i18n.language}</span>
    </div>
  );
}

export default LanguageSwitcher;
```

## ğŸš€ é«˜çº§ç”¨æ³•

### 1. æ‡’åŠ è½½ç¿»è¯‘èµ„æº

é’ˆå¯¹å¤§å‹åº”ç”¨ï¼Œå¯ä»¥æŒ‰éœ€åŠ è½½ç¿»è¯‘èµ„æºï¼Œæé«˜åˆå§‹åŠ è½½é€Ÿåº¦ï¼š

```jsx
import { Suspense } from 'react';
import { useTranslation } from 'react-i18next';

// é…ç½®i18next-http-backend
// åœ¨i18n/index.tsä¸­:
i18n.use(Backend).init({
  backend: {
    loadPath: '/locales/{{lng}}/{{ns}}.json',
  },
  // ...å…¶ä»–é…ç½®
});

// åœ¨åº”ç”¨ä¸­ä½¿ç”¨
function App() {
  return (
    <Suspense fallback={<div>Loading translations...</div>}>
      <MyComponent />
    </Suspense>
  );
}

function MyComponent() {
  // ä¼šè§¦å‘æŒ‰éœ€åŠ è½½ç¿»è¯‘æ–‡ä»¶
  const { t } = useTranslation('admin', { useSuspense: true });

  return <div>{t('title')}</div>;
}
```

### 2. ä½¿ç”¨HOCåŒ…è£…ç»„ä»¶

é’ˆå¯¹ç±»ç»„ä»¶æˆ–éœ€è¦åœ¨å¤šä¸ªç»„ä»¶é‡ç”¨ç¿»è¯‘é€»è¾‘æ—¶ï¼š

```jsx
import { withTranslation } from 'react-i18next';

class LegacyComponent extends React.Component {
  render() {
    const { t } = this.props;
    return <h1>{t('common:welcome')}</h1>;
  }
}

export default withTranslation(['common'])(LegacyComponent);
```

### 3. ä½¿ç”¨Transç»„ä»¶å¤„ç†åµŒå¥—HTML

å½“ç¿»è¯‘å†…å®¹åŒ…å«HTMLæˆ–Reactç»„ä»¶æ—¶ï¼š

```jsx
import { Trans } from 'react-i18next';

// ç¿»è¯‘æ–‡ä»¶
// "welcome": "Welcome to <bold>{{name}}</bold>, click <link>here</link> to learn more"

function WelcomeWithHtml() {
  return (
    <Trans
      i18nKey="common:welcome"
      values={{ name: 'React' }}
      components={{
        bold: <strong />,
        link: <a href="/docs" />,
      }}
    />
  );
}
```

## âš¡ æ€§èƒ½ä¼˜åŒ–

### 1. ä½¿ç”¨å‘½åç©ºé—´åˆ†å‰²æ–‡ä»¶

```jsx
// åªåŠ è½½éœ€è¦çš„å‘½åç©ºé—´
const { t } = useTranslation(['common']);
```

### 2. é¿å…ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“

```jsx
// ä½¿ç”¨ react-i18next çš„ t å‡½æ•°ç¼“å­˜
const MyComponent = React.memo(({ item }) => {
  const { t } = useTranslation();
  return (
    <div>
      {t('label')}: {item.name}
    </div>
  );
});
```

### 3. é¢„åŠ è½½å…³é”®ç¿»è¯‘

```jsx
// é¢„å…ˆåŠ è½½æ ¸å¿ƒç¿»è¯‘
i18n.loadNamespaces(['common', 'auth']).then(() => {
  // åº”ç”¨åˆå§‹åŒ–
});
```

### 4. ä½¿ç”¨æœåŠ¡ç«¯æ¸²æŸ“

```jsx
// Next.jsä¸­ä½¿ç”¨SSR
import { serverSideTranslations } from 'next-i18next/serverSideTranslations';

export async function getStaticProps({ locale }) {
  return {
    props: {
      ...(await serverSideTranslations(locale, ['common', 'home'])),
    },
  };
}
```

## ğŸ“± å®é™…é¡¹ç›®æ¡ˆä¾‹

### å¤šè¯­è¨€ç”µå­å•†åŠ¡ç½‘ç«™

```jsx
// å•†å“è¯¦æƒ…é¡µ
function ProductDetail({ product }) {
  const { t, i18n } = useTranslation(['products', 'common']);
  const currentLocale = i18n.language;

  // æ ¼å¼åŒ–ä»·æ ¼å’Œè´§å¸
  const formattedPrice = new Intl.NumberFormat(currentLocale, {
    style: 'currency',
    currency: currentLocale === 'zh-CN' ? 'CNY' : 'USD',
  }).format(product.price);

  return (
    <div className="product-detail">
      <h1>{product.name[currentLocale]}</h1>
      <p className="description">{product.description[currentLocale]}</p>
      <div className="price">{formattedPrice}</div>
      <button className="add-to-cart">{t('common:buttons.addToCart')}</button>
      <div className="shipping">
        {t('products:shipping.info', { days: product.shippingDays })}
      </div>
    </div>
  );
}
```

### è¯­è¨€æ„ŸçŸ¥è·¯ç”±ï¼ˆNext.jsï¼‰

```jsx
// pages/[locale]/products/[id].js
import { useRouter } from 'next/router';
import { useTranslation } from 'next-i18next';

export default function ProductPage() {
  const router = useRouter();
  const { locale, id } = router.query;
  const { t } = useTranslation();

  // è¯­è¨€åˆ‡æ¢å‡½æ•°
  const changeLanguage = (newLocale) => {
    router.push('/[locale]/products/[id]', `/${newLocale}/products/${id}`, {
      locale: newLocale,
    });
  };

  return (
    <div>
      {/* é¡µé¢å†…å®¹ */}
      <LanguageSwitcher onChange={changeLanguage} />
    </div>
  );
}
```

## â“ å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

### 1. å¯Œæ–‡æœ¬å†…å®¹çš„ç¿»è¯‘

**é—®é¢˜**: éœ€è¦ç¿»è¯‘åŒ…å«HTMLçš„å¯Œæ–‡æœ¬å†…å®¹  
**è§£å†³æ–¹æ¡ˆ**: ä½¿ç”¨`Trans`ç»„ä»¶å’Œ`dangerouslySetInnerHTML`ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰

```jsx
// ä½¿ç”¨Transç»„ä»¶
<Trans i18nKey="content.html" components={{ em: <em /> }} />;

// ä½¿ç”¨dangerouslySetInnerHTMLï¼ˆç¡®ä¿å†…å®¹å®‰å…¨ï¼‰
function RichTextContent() {
  const { t } = useTranslation();
  return <div dangerouslySetInnerHTML={{ __html: t('content.html') }} />;
}
```

### 2. æ•°å­—å’Œæ—¥æœŸæœ¬åœ°åŒ–

**é—®é¢˜**: ä¸åŒåŒºåŸŸçš„æ•°å­—å’Œæ—¥æœŸæ ¼å¼ä¸åŒ  
**è§£å†³æ–¹æ¡ˆ**: ä½¿ç”¨`Intl`APIç»“åˆi18next

```jsx
function FormattedDate({ date }) {
  const { i18n } = useTranslation();

  // æ ¹æ®å½“å‰è¯­è¨€æ ¼å¼åŒ–æ—¥æœŸ
  const formattedDate = new Intl.DateTimeFormat(i18n.language, {
    year: 'numeric',
    month: 'long',
    day: 'numeric',
  }).format(new Date(date));

  return <span>{formattedDate}</span>;
}
```

### 3. åŠ¨æ€é”®åç¿»è¯‘

**é—®é¢˜**: ç¿»è¯‘é”®éœ€è¦åŠ¨æ€ç”Ÿæˆ  
**è§£å†³æ–¹æ¡ˆ**: ä½¿ç”¨æ¨¡æ¿å­—ç¬¦ä¸²

```jsx
function DynamicTranslation({ section, key }) {
  const { t } = useTranslation();
  const translationKey = `${section}.${key}`;

  return <span>{t(translationKey)}</span>;
}
```

### 4. å¤„ç†ç¿»è¯‘ç¼ºå¤±

**é—®é¢˜**: æŸäº›ç¿»è¯‘åœ¨æŸè¯­è¨€ä¸­ç¼ºå¤±  
**è§£å†³æ–¹æ¡ˆ**: è®¾ç½®å›é€€æœºåˆ¶å’Œè°ƒè¯•å·¥å…·

```jsx
// i18né…ç½®ä¸­
i18n.init({
  fallbackLng: 'en-US',
  saveMissing: true, // å¼€å‘æ¨¡å¼ä¸‹ä¿å­˜ç¼ºå¤±çš„ç¿»è¯‘
  missingKeyHandler: (lng, ns, key) => {
    console.warn(`Missing translation: ${key} in ${ns} for ${lng}`);
    // å¯ä»¥å°†ç¼ºå¤±çš„é”®å‘é€åˆ°åç«¯æ”¶é›†
  },
});
```

## âœ… æœ€ä½³å®è·µ

1. **ç»“æ„åŒ–ç¿»è¯‘**ï¼šä½¿ç”¨å‘½åç©ºé—´ç»„ç»‡ç¿»è¯‘æ–‡ä»¶ï¼Œä¾¿äºç»´æŠ¤
2. **URL æŒä¹…åŒ–**ï¼šé€šè¿‡ URL å‚æ•°ä¿å­˜è¯­è¨€é€‰æ‹©ï¼Œä¾¿äºåˆ†äº«å’Œ SEO
3. **æœ¬åœ°å­˜å‚¨**ï¼šåŒæ—¶ä¿å­˜åœ¨ cookie å’Œ localStorage ä¸­ï¼Œæé«˜ç”¨æˆ·ä½“éªŒ
4. **å›é€€æœºåˆ¶**ï¼šè®¾ç½®é»˜è®¤è¯­è¨€ä½œä¸ºå›é€€é€‰é¡¹ï¼Œé¿å…æ˜¾ç¤ºç©ºç™½å†…å®¹
5. **ICU æ ¼å¼æ”¯æŒ**ï¼šå¤„ç†å¤æ•°ã€æ€§åˆ«ç­‰å¤æ‚è¯­è¨€æƒ…å†µ
6. **æŒ‰éœ€åŠ è½½**ï¼šå¤§å‹åº”ç”¨ä½¿ç”¨æ‡’åŠ è½½ä¼˜åŒ–æ€§èƒ½
7. **ç±»å‹å®‰å…¨**ï¼šç»“åˆTypeScriptå®šä¹‰ç¿»è¯‘ç±»å‹
8. **ç¿»è¯‘ç®¡ç†**ï¼šä½¿ç”¨ä¸“ä¸šç¿»è¯‘ç®¡ç†å·¥å…·æˆ–æœåŠ¡ï¼Œå¦‚Lokaliseã€Crowdin
9. **è‡ªåŠ¨åŒ–**ï¼šé›†æˆåˆ°CI/CDæµç¨‹ï¼Œè‡ªåŠ¨æ£€æµ‹ç¼ºå¤±ç¿»è¯‘
10. **æœ¬åœ°åŒ–æµ‹è¯•**ï¼šé’ˆå¯¹ä¸åŒè¯­è¨€ç¯å¢ƒè¿›è¡Œæµ‹è¯•

## ğŸ“ æ€»ç»“

é€šè¿‡ç»“åˆ i18next ç”Ÿæ€ç³»ç»Ÿï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ React é¡¹ç›®ä¸­å®ç°åŠŸèƒ½å®Œå–„çš„å›½é™…åŒ–æ–¹æ¡ˆã€‚è¿™ç§æ–¹æ¡ˆä¸ä»…æ”¯æŒåŸºæœ¬çš„æ–‡æœ¬ç¿»è¯‘ï¼Œè¿˜èƒ½å¤„ç†å¤æ‚çš„è¯­è¨€ç‰¹æ€§ï¼Œæä¾›è‰¯å¥½çš„ç”¨æˆ·ä½“éªŒã€‚

åˆç†çš„é¡¹ç›®ç»“æ„å’Œå¼€å‘å®è·µå¯ä»¥ä½¿å›½é™…åŒ–å·¥ä½œå˜å¾—æ›´åŠ é«˜æ•ˆå’Œå¯ç»´æŠ¤ã€‚éšç€åº”ç”¨çš„å…¨çƒåŒ–ï¼ŒæŠ•å…¥å›½é™…åŒ–çš„å·¥ä½œå°†å¸¦æ¥æ˜¾è‘—çš„ç”¨æˆ·å¢é•¿å’Œå¸‚åœºæ‰©å±•æ”¶ç›Šã€‚
