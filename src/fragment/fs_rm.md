# ğŸ§¹ Node.js åˆ é™¤ API ä½¿ç”¨ç¬”è®°

## ğŸ“– åˆ é™¤ API èƒ½åŠ›å¯¹æ¯”

| æ–¹æ³•å                        | å¼‚æ­¥/åŒæ­¥       | æ˜¯å¦æ”¯æŒç›®å½•   | æ˜¯å¦é€’å½’åˆ é™¤ | æ˜¯å¦æ”¯æŒ force | æ˜¯å¦æ¨è            |
| ----------------------------- | --------------- | -------------- | ------------ | -------------- | ------------------- |
| fs.rm(path, options, cb)      | å¼‚æ­¥ï¼ˆå›è°ƒï¼‰    | âœ…             | âœ…           | âœ…             | âœ… æ¨è             |
| fs.rmSync(path, options)      | åŒæ­¥            | âœ…             | âœ…           | âœ…             | âœ… æ¨è             |
| fs.promises.rm(path, options) | å¼‚æ­¥ï¼ˆPromiseï¼‰ | âœ…             | âœ…           | âœ…             | âœ… æ¨èï¼ˆç°ä»£é¡¹ç›®ï¼‰ |
| fs.unlink(path, cb)           | å¼‚æ­¥ï¼ˆå›è°ƒï¼‰    | âŒï¼ˆä»…æ–‡ä»¶ï¼‰   | âŒ           | âŒ             | âŒ ä¸æ¨è           |
| fs.unlinkSync(path)           | åŒæ­¥            | âŒï¼ˆä»…æ–‡ä»¶ï¼‰   | âŒ           | âŒ             | âŒ ä¸æ¨è           |
| fs.rmdir(path, options, cb)   | å¼‚æ­¥ï¼ˆå›è°ƒï¼‰    | âœ…ï¼ˆä»…ç©ºç›®å½•ï¼‰ | âš ï¸ æœ‰é™æ”¯æŒ  | âŒ             | âš ï¸ å¼ƒç”¨             |
| fs.rmdirSync(path, options)   | åŒæ­¥            | âœ…ï¼ˆä»…ç©ºç›®å½•ï¼‰ | âš ï¸ æœ‰é™æ”¯æŒ  | âŒ             | âš ï¸ å¼ƒç”¨             |

## âš ï¸ é‡è¦è¯´æ˜ï¼š`fs.rm*` â‰  `fs.rmdir*`

- **`fs.rm*` ç³»åˆ—åŒ…æ‹¬ï¼š`fs.rm`ã€`fs.rmSync`ã€`fs.promises.rm`ï¼Œæ˜¯ Node.js æ–°å¢çš„ç»Ÿä¸€åˆ é™¤æ¥å£ï¼ŒåŠŸèƒ½å¼ºå¤§ï¼Œæ”¯æŒé€’å½’åˆ é™¤ã€å¼ºåˆ¶åˆ é™¤ç­‰å¤šç§é€‰é¡¹ã€‚**

- **`fs.rmdir` å’Œ `fs.rmdirSync` æ˜¯æ—§æ¥å£ï¼Œåªé’ˆå¯¹ç›®å½•åˆ é™¤ï¼Œä¸”ä¸æ”¯æŒ `force`ï¼Œåªåœ¨éƒ¨åˆ† Node.js ç‰ˆæœ¬æ”¯æŒæœ‰é™é€’å½’åˆ é™¤ï¼Œå·²è¢«å®˜æ–¹åºŸå¼ƒã€‚**

## âœ… æ¨èä½¿ç”¨çš„é…ç½®ï¼ˆä»…é€‚ç”¨äº `fs.rm*` ç³»åˆ—ï¼‰

```ts
{
  recursive: true,
  force: true,
  maxRetries?: number,
  retryDelay?: number,
  glob?: boolean // ä»…å¼‚æ­¥çš„ fs.rm æ”¯æŒ
}
```

| é€‰é¡¹         | è¯´æ˜                                          | é€‚ç”¨èŒƒå›´               |
| ------------ | --------------------------------------------- | ---------------------- |
| `recursive`  | æ˜¯å¦é€’å½’åˆ é™¤ç›®å½•åŠå…¶ä¸­å†…å®¹                    | âœ… ä»… `fs.rm*` æ”¯æŒ    |
| `force`      | æ–‡ä»¶æˆ–ç›®å½•ä¸å­˜åœ¨æ—¶ä¸æŠ›é”™                      | âœ… ä»… `fs.rm*` æ”¯æŒ    |
| `maxRetries` | åˆ é™¤å¤±è´¥æ—¶çš„æœ€å¤§é‡è¯•æ¬¡æ•°ï¼ˆä»… Windows ä¸‹ç”Ÿæ•ˆï¼‰ | âœ… ä»… `fs.rm*` æ”¯æŒ    |
| `retryDelay` | é‡è¯•çš„æ—¶é—´é—´éš”ï¼ˆæ¯«ç§’ï¼‰                        | âœ… ä»… `fs.rm*` æ”¯æŒ    |
| `glob`       | æ˜¯å¦å¯ç”¨é€šé…ç¬¦åŒ¹é…ï¼ˆä»…å¼‚æ­¥ `fs.rm` æ”¯æŒï¼‰     | âœ… ä»…å¼‚æ­¥ `fs.rm` æ”¯æŒ |

> â—ï¸ `fs.rmdir*` å’Œ `fs.unlink*` ç­‰æ—§æ¥å£**ä¸æ”¯æŒè¿™äº›é€‰é¡¹**ï¼Œä¼ å…¥ä¼šå¯¼è‡´é”™è¯¯ã€‚

## âœ… æ­£ç¡®ç¤ºä¾‹

```ts
import { rm } from 'fs/promises';

await rm('output/logs', {
  recursive: true,
  force: true,
});
```

```ts
import fs from 'fs';

fs.rmSync('build', {
  recursive: true,
  force: true,
});
```

## âŒ é”™è¯¯ç¤ºä¾‹ï¼ˆé¿å…ï¼‰

```ts
// rmdir ä¸æ”¯æŒ forceï¼Œä¼ å…¥ä¼šæŠ›é”™
fs.rmdirSync('some-dir', { recursive: true, force: true });

// unlink ä¸æ”¯æŒ options å‚æ•°
fs.unlink('file.txt', { force: true });
```

## â—ï¸ å¯èƒ½ä»ä¼šæŠ›å‡ºçš„é”™è¯¯ï¼ˆå³ä½¿ä½¿ç”¨ force: trueï¼‰

| é”™è¯¯ç                | åœºæ™¯è¯´æ˜                             |
| -------------------- | ------------------------------------ |
| `EACCES` / `EPERM`   | æƒé™ä¸è¶³ / å°è¯•åˆ é™¤ç³»ç»Ÿå…³é”®è·¯å¾„      |
| `EBUSY`              | æ–‡ä»¶æˆ–ç›®å½•è¢«ç³»ç»Ÿå ç”¨ï¼ˆWindows å¸¸è§ï¼‰ |
| `EISDIR` / `ENOTDIR` | è·¯å¾„ç±»å‹ä¸ç¬¦ï¼ˆæ–‡ä»¶å½“ç›®å½•æˆ–åä¹‹ï¼‰     |
| `EMFILE` / `ENFILE`  | æ‰“å¼€æ–‡ä»¶è¿‡å¤š                         |
| `ELOOP`              | ç¬¦å·é“¾æ¥å¾ªç¯å¼•ç”¨                     |

## ğŸ§ª å®ç”¨å·¥å…·å‡½æ•°ç¤ºä¾‹

```ts
import { rm } from 'fs/promises';

export async function safeRemove(path: string) {
  try {
    await rm(path, { recursive: true, force: true });
    console.log(`âœ… åˆ é™¤æˆåŠŸ: ${path}`);
  } catch (err: any) {
    console.error(`âŒ åˆ é™¤å¤±è´¥: ${path}`);
    console.error(`é”™è¯¯ä»£ç : ${err.code}, ä¿¡æ¯: ${err.message}`);
  }
}
```

## ğŸ§¼ æ€»ç»“å»ºè®®

- âœ… ç»Ÿä¸€ä½¿ç”¨ `fs.rm\*` ç³»åˆ—ï¼ˆæ”¯æŒæ–‡ä»¶å’Œç›®å½•åˆ é™¤ï¼‰
- âš ï¸ `{ recursive: true, force: true }` ä»…é€‚ç”¨äº `fs.rm`ï¼Œä¸è¦ç”¨äº `unlink / rmdir`
- âœ… `fs.promises.rm` é€‚ç”¨äºç°ä»£ `async/await` å¼‚æ­¥é¡¹ç›®
- âš ï¸ æƒé™é—®é¢˜ã€å ç”¨æ–‡ä»¶ç­‰ç³»ç»Ÿçº§é”™è¯¯ä¾ç„¶éœ€è¦ `try/catch`
