# TypeScript ç±»å‹å±‚çº§ç³»ç»Ÿï¼šä» never åˆ° any çš„å®Œæ•´æŒ‡å— ğŸ¯

## å¼•è¨€

TypeScript çš„ç±»å‹ç³»ç»Ÿæ˜¯å…¶æœ€å¼ºå¤§çš„ç‰¹æ€§ä¹‹ä¸€ï¼Œå®ƒä¸ä»…èƒ½å¸®åŠ©æˆ‘ä»¬åœ¨å¼€å‘æ—¶æ•è·é”™è¯¯ï¼Œè¿˜èƒ½æä¾›æ›´å¥½çš„ä»£ç æç¤ºå’Œæ–‡æ¡£ã€‚ç†è§£ç±»å‹å±‚çº§ç³»ç»Ÿæ˜¯æŒæ¡ TypeScript ç±»å‹ç³»ç»Ÿçš„å…³é”®ã€‚æœ¬æ–‡å°†å¸¦ä½ ä»æœ€åº•å±‚çš„ never ç±»å‹å¼€å§‹ï¼Œé€æ­¥æ¢ç´¢ç›´åˆ°æœ€é¡¶å±‚çš„ any ç±»å‹ï¼Œå…¨é¢äº†è§£ TypeScript çš„ç±»å‹å±‚çº§å…³ç³»ã€‚ğŸš€

### ç±»å‹å…¼å®¹æ€§åˆ¤æ–­

åœ¨å¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£ TypeScript å¦‚ä½•åˆ¤æ–­ç±»å‹ä¹‹é—´çš„å…¼å®¹æ€§ã€‚ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼ï¼š

1. èµ‹å€¼å…¼å®¹æ€§ï¼šé€šè¿‡èµ‹å€¼æ“ä½œåˆ¤æ–­ç±»å‹å…¼å®¹æ€§ ğŸ”„
2. æ¡ä»¶ç±»å‹ï¼šä½¿ç”¨ extends å…³é”®å­—åˆ¤æ–­ç±»å‹å…¼å®¹æ€§ âš¡
3. ç±»å‹æ–­è¨€ï¼šé€šè¿‡ç±»å‹æ–­è¨€åˆ¤æ–­ç±»å‹å…¼å®¹æ€§ ğŸ­

```ts
// èµ‹å€¼å…¼å®¹æ€§
let x: string = 'hello';
let y: any = x; // OKï¼Œstring å¯ä»¥èµ‹å€¼ç»™ any

// æ¡ä»¶ç±»å‹
type IsString<T> = T extends string ? true : false;
type A = IsString<'hello'>; // true
type B = IsString<123>; // false

// ç±»å‹æ–­è¨€
let z: unknown = 'hello';
let w: string = z as string; // OKï¼Œé€šè¿‡ç±»å‹æ–­è¨€
```

## ç±»å‹å±‚çº§é“¾ï¼šæ ¸å¿ƒæ¦‚å¿µ ğŸ”—

è®©æˆ‘ä»¬å…ˆé€šè¿‡ä¸€ä¸ªå®Œæ•´çš„ç±»å‹å±‚çº§é“¾æ¥äº†è§£ TypeScript çš„ç±»å‹å±‚çº§å…³ç³»ï¼š

```ts
type TypeChain = never extends 'renouc' // 1: never æ˜¯æ‰€æœ‰ç±»å‹çš„å­ç±»å‹
  ? 'renouc' extends 'renouc' | '599' // 2: å­—é¢é‡ç±»å‹æ˜¯å…¶è”åˆç±»å‹çš„å­ç±»å‹
    ? 'renouc' | '599' extends string // 3: è”åˆç±»å‹æ˜¯åŸå§‹ç±»å‹çš„å­ç±»å‹
      ? string extends String // 4: åŸå§‹ç±»å‹æ˜¯å…¶åŒ…è£…ç±»å‹çš„å­ç±»å‹
        ? String extends Object // 5: åŒ…è£…ç±»å‹æ˜¯ Object çš„å­ç±»å‹
          ? Object extends any // 6: Object æ˜¯ any çš„å­ç±»å‹
            ? any extends unknown // 7: any æ˜¯ unknown çš„å­ç±»å‹
              ? unknown extends any // 8: unknown ä¹Ÿæ˜¯ any çš„å­ç±»å‹
                ? 8
                : 7
              : 6
            : 5
          : 4
        : 3
      : 2
    : 1
  : 0;
```

## ä»åº•å±‚åˆ°é¡¶å±‚ï¼šç±»å‹å±‚çº§è¯¦è§£ ğŸ“Š

### never ç±»å‹ï¼šä¸‡ç‰©ä¹‹å§‹ ğŸŒ±

never ç±»å‹æ˜¯ TypeScript ç±»å‹ç³»ç»Ÿä¸­æœ€åº•å±‚çš„ç±»å‹ï¼Œå®ƒæ˜¯æ‰€æœ‰ç±»å‹çš„å­ç±»å‹ã€‚è¿™æ„å‘³ç€ never ç±»å‹å¯ä»¥èµ‹å€¼ç»™ä»»ä½•å…¶ä»–ç±»å‹ï¼Œä½†æ²¡æœ‰ä»»ä½•ç±»å‹å¯ä»¥èµ‹å€¼ç»™ never ç±»å‹ã€‚

```ts
let x: never;
let y: string = x; // OKï¼Œnever å¯ä»¥èµ‹å€¼ç»™ä»»ä½•ç±»å‹
// x = y; // Errorï¼Œå…¶ä»–ç±»å‹ä¸èƒ½èµ‹å€¼ç»™ never
```

### å­—é¢é‡ç±»å‹ä¸åŸå§‹ç±»å‹ ğŸ“

å­—é¢é‡ç±»å‹æ˜¯ TypeScript ä¸­æœ€å…·ä½“çš„ç±»å‹ï¼Œå®ƒä»¬æ˜¯å…¶å¯¹åº”åŸå§‹ç±»å‹çš„å­ç±»å‹ã€‚

```ts
let x: 'hello' = 'hello';
let y: string = x; // OKï¼Œå­—é¢é‡ç±»å‹æ˜¯åŸå§‹ç±»å‹çš„å­ç±»å‹
// x = y; // Errorï¼ŒåŸå§‹ç±»å‹ä¸èƒ½èµ‹å€¼ç»™å­—é¢é‡ç±»å‹
```

### è”åˆç±»å‹ä¸äº¤å‰ç±»å‹ ğŸ”„

è”åˆç±»å‹è¡¨ç¤ºä¸€ä¸ªå€¼å¯ä»¥æ˜¯å¤šä¸ªç±»å‹ä¸­çš„ä»»æ„ä¸€ä¸ªï¼Œè€Œäº¤å‰ç±»å‹è¡¨ç¤ºä¸€ä¸ªå€¼å¿…é¡»åŒæ—¶æ»¡è¶³å¤šä¸ªç±»å‹çš„è¦æ±‚ã€‚

```ts
type A = string | number;
type B = string & number; // neverï¼Œå› ä¸ºä¸å­˜åœ¨åŒæ—¶æ˜¯ string å’Œ number çš„å€¼

let x: A = 'hello'; // OK
x = 123; // OK
// x = true; // Error
```

### åŒ…è£…ç±»å‹ä¸å¯¹è±¡ç±»å‹ ğŸ“¦

åŸå§‹ç±»å‹æœ‰å…¶å¯¹åº”çš„åŒ…è£…ç±»å‹ï¼ŒåŒ…è£…ç±»å‹æ˜¯ Object çš„å­ç±»å‹ã€‚

```ts
let x: string = 'hello';
let y: String = new String('hello');
let z: Object = y; // OKï¼ŒåŒ…è£…ç±»å‹æ˜¯ Object çš„å­ç±»å‹
```

### any ä¸ unknownï¼šç±»å‹ä¹‹å·… ğŸ‘‘

any å’Œ unknown æ˜¯ TypeScript ç±»å‹ç³»ç»Ÿä¸­æœ€é¡¶å±‚çš„ç±»å‹ï¼Œå®ƒä»¬å¯ä»¥æ¥å—ä»»ä½•ç±»å‹çš„å€¼ã€‚ä½†æ˜¯å®ƒä»¬çš„è¡Œä¸ºæœ‰å¾ˆå¤§çš„ä¸åŒï¼š

```ts
// any ç±»å‹ï¼ˆä¸æ¨èä½¿ç”¨ï¼‰âš ï¸
let x: any = 'hello';
x = 123; // OKï¼Œå¯ä»¥æ¥å—ä»»ä½•ç±»å‹çš„å€¼
x.toUpperCase(); // OKï¼Œå¯ä»¥è°ƒç”¨ä»»ä½•æ–¹æ³•ï¼ˆä½†è¿è¡Œæ—¶å¯èƒ½å‡ºé”™ï¼‰
let y: number = x; // OKï¼Œany å¯ä»¥èµ‹å€¼ç»™ä»»ä½•ç±»å‹

// unknown ç±»å‹ï¼ˆæ¨èä½¿ç”¨ï¼‰âœ…
let a: unknown = 'hello';
a = 123; // OKï¼Œå¯ä»¥æ¥å—ä»»ä½•ç±»å‹çš„å€¼
// a.toUpperCase(); // Errorï¼Œä¸èƒ½ç›´æ¥è°ƒç”¨æ–¹æ³•
// let b: number = a; // Errorï¼Œä¸èƒ½ç›´æ¥èµ‹å€¼ç»™å…¶ä»–ç±»å‹
if (typeof a === 'string') {
  a.toUpperCase(); // OKï¼Œç»è¿‡ç±»å‹æ£€æŸ¥åå¯ä»¥ä½¿ç”¨
  let b: string = a; // OKï¼Œç»è¿‡ç±»å‹æ£€æŸ¥åå¯ä»¥èµ‹å€¼
}
```

## ç‰¹æ®Šç±»å‹å…³ç³» ğŸ”—

### ç±»ç»§æ‰¿å…³ç³» ğŸ—ï¸

ç±»çš„ç»§æ‰¿å…³ç³»ä¼šå½±å“ç±»å‹å…¼å®¹æ€§ï¼Œå­ç±»å¯ä»¥èµ‹å€¼ç»™çˆ¶ç±»ï¼Œä½†åä¹‹åˆ™ä¸è¡Œã€‚

```ts
class Animal {
  name: string;
}

class Dog extends Animal {
  bark(): void {}
}

let animal: Animal = new Dog(); // OK
// let dog: Dog = new Animal(); // Error
```

### æ¥å£å®ç°å…³ç³» ğŸ“

æ¥å£çš„å®ç°å…³ç³»ä¹Ÿä¼šå½±å“ç±»å‹å…¼å®¹æ€§ï¼Œå®ç°æ¥å£çš„ç±»å¯ä»¥èµ‹å€¼ç»™æ¥å£ç±»å‹ã€‚

```ts
interface Animal {
  name: string;
}

class Dog implements Animal {
  name: string;
  bark(): void {}
}

let animal: Animal = new Dog(); // OK
```

### æ³›å‹ç±»å‹å…³ç³» ğŸ­

æ³›å‹ç±»å‹ä¹‹é—´çš„å…³ç³»æ¯”è¾ƒå¤æ‚ï¼Œéœ€è¦è€ƒè™‘åå˜ã€é€†å˜å’Œä¸å˜æ€§ã€‚

```ts
type Covariant<T> = T;
type Contravariant<T> = (x: T) => void;
type Invariant<T> = { value: T };

let x: Covariant<string> = 'hello';
let y: Covariant<any> = x; // OKï¼Œåå˜

let f: Contravariant<any> = (x: any) => {};
let g: Contravariant<string> = f; // OKï¼Œé€†å˜

let a: Invariant<string> = { value: 'hello' };
// let b: Invariant<any> = a; // Errorï¼Œä¸å˜
```

### æ•°ç»„ä¸å…ƒç»„å…³ç³» ğŸ“Š

æ•°ç»„å’Œå…ƒç»„ä¹‹é—´çš„å…³ç³»ä¹Ÿéµå¾ªç±»å‹å±‚çº§è§„åˆ™ã€‚

```ts
let x: [string, number] = ['hello', 123];
let y: (string | number)[] = x; // OK
// x = y; // Error
```

## å®é™…åº”ç”¨åœºæ™¯ ğŸ› ï¸

### ç±»å‹ä¿æŠ¤ ğŸ›¡ï¸

ç±»å‹ä¿æŠ¤å¯ä»¥å¸®åŠ©æˆ‘ä»¬åœ¨è¿è¡Œæ—¶ç¡®å®šå€¼çš„å…·ä½“ç±»å‹ã€‚

```ts
function isString(x: unknown): x is string {
  return typeof x === 'string';
}

let x: unknown = 'hello';
if (isString(x)) {
  x.toUpperCase(); // OK
}
```

### ç±»å‹æ–­è¨€ ğŸ­

ç±»å‹æ–­è¨€å…è®¸æˆ‘ä»¬æ‰‹åŠ¨æŒ‡å®šå€¼çš„ç±»å‹ã€‚

```ts
let x: any = 'hello';
let y: string = x as string; // OK
```

### æ¡ä»¶ç±»å‹ âš¡

æ¡ä»¶ç±»å‹å¯ä»¥æ ¹æ®ç±»å‹å…³ç³»åˆ›å»ºæ–°çš„ç±»å‹ã€‚

```ts
type NonNullable<T> = T extends null | undefined ? never : T;
type A = NonNullable<string | null>; // string
```

### ç±»å‹æ”¶çª„ ğŸ”

ç±»å‹æ”¶çª„å¯ä»¥å¸®åŠ©æˆ‘ä»¬ç¼©å°å€¼çš„å¯èƒ½ç±»å‹èŒƒå›´ã€‚

```ts
function process(x: string | number) {
  if (typeof x === 'string') {
    x.toUpperCase(); // OK
  } else {
    x.toFixed(); // OK
  }
}
```

## æœ€ä½³å®è·µä¸æ€»ç»“ ğŸ“š

### ç±»å‹è®¾è®¡åŸåˆ™ ğŸ¯

1. ä¼˜å…ˆä½¿ç”¨å…·ä½“çš„ç±»å‹
2. é¿å…ä½¿ç”¨ anyï¼Œæ”¹ç”¨ unknown
3. åˆç†ä½¿ç”¨ç±»å‹æ–­è¨€
4. åˆ©ç”¨ç±»å‹æ¨æ–­

### å¸¸è§é”™è¯¯ä¸è§£å†³æ–¹æ¡ˆ âš ï¸

1. ç±»å‹æ–­è¨€æ»¥ç”¨
2. è¿‡åº¦ä½¿ç”¨ anyï¼ˆåº”è¯¥ä½¿ç”¨ unknownï¼‰
3. å¿½ç•¥ç±»å‹æ£€æŸ¥
4. é”™è¯¯ä½¿ç”¨ç±»å‹ä¿æŠ¤

### æ€§èƒ½è€ƒè™‘ âš¡

1. ç±»å‹æ£€æŸ¥å¯¹ç¼–è¯‘æ—¶é—´çš„å½±å“
2. ç±»å‹å¤æ‚åº¦çš„å¹³è¡¡
3. ç±»å‹æ¨å¯¼çš„ä¼˜åŒ–
