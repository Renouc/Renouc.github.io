# TypeScript å†…ç½®ç±»å‹ä¸ç±»å‹æ–­è¨€ ğŸ§©

## å†…ç½®ç±»å‹ ğŸ”°

### any - ä¸‡èƒ½è¯ ğŸ¦¸â€â™‚ï¸

å˜¿ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬å†™ TS ä»£ç ä¸éœ€è¦é‚£ä¹ˆä¸¥æ ¼ï¼Œå¯¹å§ï¼Ÿæƒ³æƒ³ `console.log`ï¼Œå®ƒå•¥éƒ½èƒ½æ¥å— - å­—ç¬¦ä¸²ã€æ•°å­—ã€å¯¹è±¡... å•¥éƒ½è¡Œï¼éš¾é“æˆ‘ä»¬è¦æŠŠæ‰€æœ‰ç±»å‹éƒ½ç”¨è”åˆç±»å‹è¿èµ·æ¥ï¼Ÿé‚£ä¹Ÿå¤ªç–¯ç‹‚äº†ï¼

ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒTypeScript ç»™äº†æˆ‘ä»¬ä¸€ä¸ª"ä¸‡èƒ½ç‰Œ" - `any` ç±»å‹ï¼å®ƒå°±åƒç¼–ç¨‹ä¸–ç•Œçš„"éšèº«å¬"ï¼Œå•¥éƒ½èƒ½å¡è¿›å»ï¼š

```ts
log(message?: any, ...optionalParams: any[]): void
```

çœ‹ï¼Œè¿™é‡Œçš„ `message` å‚æ•°æ˜¯ `any` ç±»å‹ï¼Œåé¢çš„ `optionalParams` ä¹Ÿæ˜¯ `any[]` ç±»å‹ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥ç”¨ä»»ä½•ç±»å‹ã€ä»»æ„æ•°é‡çš„å‚æ•°æ¥è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œå¤ªçµæ´»äº†ï¼âœ¨

#### any çš„ç‰¹æ€§

é™¤äº†æ˜ç¡®æ ‡æ³¨ä¸º `any`ï¼Œæœ‰äº›æƒ…å†µä¸‹å˜é‡ä¼šè¢«è‡ªåŠ¨æ¨å¯¼ä¸º `any`ï¼š

```ts
// æ‚„æ‚„å˜æˆäº† any
let foo;

// fooã€bar ä¹Ÿéƒ½æ˜¯ any
function func(foo, bar) {}
```

âš ï¸ æ³¨æ„ï¼šå¦‚æœä½ åœ¨ tsconfig ä¸­å¼€å¯äº† `noImplicitAny`ï¼Œä¸Šé¢è¿™æ ·å†™ä¼šæŠ¥é”™ã€‚ä½ å¾—æ˜¾å¼åœ°æŒ‡å®šå®ƒä»¬ä¸º `any` ç±»å‹ï¼Œæˆ–è€…æš‚æ—¶å…³é—­è¿™ä¸ªé…ç½®ï¼ˆä¸æ¨èå“¦ï¼‰ã€‚

`any` ç±»å‹çš„å˜é‡ç®€ç›´åƒä¸ªå˜å½¢é‡‘åˆšï¼Œæƒ³æ€ä¹ˆå˜å°±æ€ä¹ˆå˜ï¼š

```ts
// any ç±»å‹ï¼Œéšä¾¿æ€ä¹ˆæéƒ½è¡Œ
let anyVar: any = "éšä¾¿å†™ç‚¹å•¥";

anyVar = false;         // å˜æˆå¸ƒå°”å€¼ï¼Ÿæ²¡é—®é¢˜ï¼
anyVar = "å†æ¥ç‚¹å­—ç¬¦ä¸²"; // å†å˜å›å­—ç¬¦ä¸²ï¼Ÿä¹Ÿæ²¡é—®é¢˜ï¼
anyVar = {
  name: "å¼ ä¸‰",         // å˜æˆå¯¹è±¡ï¼Ÿå®Œå…¨OKï¼
};

anyVar = () => {};      // å˜æˆå‡½æ•°ï¼Ÿä¹Ÿè¡Œï¼

// å…¶ä»–å…·ä½“ç±»å‹çš„å˜é‡ä¹Ÿèƒ½æ¥å— any ç±»å‹çš„å€¼ï¼ˆè¿™å¾ˆå±é™©ï¼âš¡ï¼‰
const val1: string = anyVar;
const val2: number = anyVar;
const val3: () => {} = anyVar;
const val4: {} = anyVar;
```

ä½ ç”šè‡³å¯ä»¥å¯¹ `any` ç±»å‹çš„å˜é‡åšä»»ä½•æ“ä½œï¼Œä¸ç®¡åˆä¸åˆç†ã€‚TypeScript æ­¤æ—¶å°±åƒæ˜¯é—­ä¸Šçœ¼ç›çš„å®‰æ£€å‘˜ï¼Œå•¥éƒ½æ”¾è¡Œï¼š

```ts
let anyVar: any = null;

// è¿™äº›æ“ä½œç¼–è¯‘æ—¶ä¸ä¼šæŠ¥é”™ï¼Œä½†è¿è¡Œæ—¶å¯èƒ½ğŸ’¥ç‚¸äº†
anyVar.foo.bar.baz();
anyVar[0][1][2].prop1;
```

#### any çš„é€‚ç”¨åœºæ™¯ ğŸ¯

`any` ç±»å‹çš„æ ¸å¿ƒæ„ä¹‰å°±æ˜¯ï¼š**"æˆ‘æƒ³å¹²å•¥å°±å¹²å•¥ï¼Œæ²¡äººç®¡å¾—ç€"** ğŸ¤ªã€‚å®ƒèƒ½å…¼å®¹æ‰€æœ‰ç±»å‹ï¼Œä¹Ÿèƒ½å¤Ÿè¢«æ‰€æœ‰ç±»å‹å…¼å®¹ã€‚è¿™å°±åƒç»™äº†ä½ ä¸€æŠŠ"ç±»å‹æ£€æŸ¥çš„åé—¨é’¥åŒ™"ï¼Œéšæ—¶å¯ä»¥è·³è¿‡æ£€æŸ¥ã€‚ä½†è®°ä½ï¼Œè·‘èµ·æ¥å‡ºé—®é¢˜äº†ï¼Œé‚£å¯æ˜¯ä½ è‡ªå·±çš„è´£ä»»å“¦ï¼

é€‚åˆä½¿ç”¨ any çš„å‡ ç§æƒ…å†µï¼š

1. **å¿«é€Ÿå¼€å‘åŸå‹** - å½“ä½ åªæ˜¯æƒ³å¿«é€ŸéªŒè¯ä¸€ä¸ªæƒ³æ³•ï¼Œä¸å…³å¿ƒç±»å‹å®‰å…¨
2. **è¿ç§» JavaScript ä»£ç ** - é€æ­¥è¿ç§»å¤§å‹ JS é¡¹ç›®åˆ° TS æ—¶çš„è¿‡æ¸¡æ–¹æ¡ˆ
3. **å¤„ç†åŠ¨æ€å†…å®¹** - ä¾‹å¦‚ä» `eval()` æˆ–æŸäº›ç‰¹æ®Š API è¿”å›çš„å†…å®¹
4. **ä¸æŸäº›åŠ¨æ€ç‰¹æ€§äº¤äº’** - æ¯”å¦‚ä½¿ç”¨ `document.createElement` åˆ›å»ºçš„å…ƒç´ 

ä½†è®°ä½ï¼Œèƒ½ä¸ç”¨ `any` å°±å°½é‡ä¸ç”¨ï¼

### unknown - è°¨æ…çš„ any ğŸ§

`unknown` ç±»å‹åƒæ˜¯ `any` çš„è°¨æ…è¡¨å¼Ÿã€‚å®ƒåŒæ ·å¯ä»¥è¢«èµ‹äºˆä»»ä½•å€¼ï¼Œä½†å½“ä½ æƒ³ç”¨å®ƒæ—¶ï¼Œå°±æ²¡é‚£ä¹ˆéšæ„äº†ï¼š

```ts
let unknownVar: unknown = "Hello";

unknownVar = false;       // âœ… å¯ä»¥èµ‹å€¼ä»»ä½•ç±»å‹
unknownVar = "å†æ¥ä¸€æ¬¡";   // âœ… æ²¡é—®é¢˜
unknownVar = {
  name: "Renouc",
};

unknownVar = () => {};

// ä½†æ˜¯ï¼ä¸èƒ½ç›´æ¥èµ‹å€¼ç»™å…¶ä»–å…·ä½“ç±»å‹ ğŸš«
const val1: string = unknownVar; // âŒ æŠ¥é”™
const val2: number = unknownVar; // âŒ æŠ¥é”™
const val3: () => {} = unknownVar; // âŒ æŠ¥é”™
const val4: {} = unknownVar; // âŒ æŠ¥é”™

// åªèƒ½èµ‹å€¼ç»™ any å’Œ unknown ç±»å‹
const val5: any = unknownVar;    // âœ… å¯ä»¥
const val6: unknown = unknownVar; // âœ… å¯ä»¥
```

`any` å’Œ `unknown` æœ€å¤§çš„åŒºåˆ«æ˜¯ï¼š`any` å°±åƒä¸ªç¤¾ç‰›ï¼Œèµ°åˆ°å“ªéƒ½æ˜¯è‡ªå·±äººï¼›è€Œ `unknown` æ›´åƒä¸ªç¤¾æï¼Œåªè·Ÿ `any` å’Œè‡ªå·±ç©å¾—æ¥ã€‚ç®€å•è¯´ï¼Œ`any` æ”¾å¼ƒäº†æ‰€æœ‰çš„ç±»å‹æ£€æŸ¥ï¼Œè€Œ `unknown` ä¿ç•™äº†å®‰å…¨æ„Ÿã€‚

è¿™ä¸€ç‚¹åœ¨è®¿é—®å±æ€§æ—¶å°¤ä¸ºæ˜æ˜¾ï¼š

```ts
let unknownVar: unknown;

unknownVar.foo(); // âŒ æŠ¥é”™ï¼šå¯¹è±¡ç±»å‹ä¸º unknown
```

#### ç±»å‹å®ˆå« - unknown çš„å®‰å…¨ä½¿ç”¨æ–¹å¼ ğŸ›¡ï¸

è¦å®‰å…¨åœ°ä½¿ç”¨ `unknown` ç±»å‹çš„å€¼ï¼Œå¿…é¡»å…ˆé€šè¿‡ç±»å‹å®ˆå«ï¼ˆType Guardsï¼‰ç¼©å°å®ƒçš„ç±»å‹èŒƒå›´ã€‚è¿™å°±åƒå…ˆæ£€æŸ¥ä¸€ä¸‹åŒ…è£¹é‡Œæ˜¯ä»€ä¹ˆï¼Œå†å†³å®šæ€ä¹ˆå¤„ç†ï¼š

```ts
function processValue(value: unknown) {
  // ç±»å‹å®ˆå«ï¼štypeof æ“ä½œç¬¦
  if (typeof value === "string") {
    // åœ¨è¿™ä¸ªåˆ†æ”¯å†…ï¼ŒTypeScript çŸ¥é“ value æ˜¯ string ç±»å‹
    return value.toUpperCase(); // âœ… å®‰å…¨ï¼
  }

  // ç±»å‹å®ˆå«ï¼šinstanceof æ“ä½œç¬¦
  if (value instanceof Date) {
    // åœ¨è¿™ä¸ªåˆ†æ”¯å†…ï¼ŒTypeScript çŸ¥é“ value æ˜¯ Date ç±»å‹
    return value.toISOString(); // âœ… å®‰å…¨ï¼
  }

  // ç±»å‹å®ˆå«ï¼šè‡ªå®šä¹‰ç±»å‹è°“è¯
  if (isProduct(value)) {
    // åœ¨è¿™ä¸ªåˆ†æ”¯å†…ï¼Œvalue è¢«è¯†åˆ«ä¸º Product ç±»å‹
    return `ï¿¥${value.price}`; // âœ… å®‰å…¨ï¼
  }

  // å¦‚æœä»¥ä¸Šæ¡ä»¶éƒ½ä¸æ»¡è¶³ï¼Œæˆ‘ä»¬ä»ç„¶ä¸çŸ¥é“ value çš„å…·ä½“ç±»å‹
  return String(value); // è½¬æˆå­—ç¬¦ä¸²å¤„ç†
}

// è‡ªå®šä¹‰ç±»å‹è°“è¯ (type predicate)ï¼Œè®© TypeScript è®¤è¯†æˆ‘ä»¬çš„ç±»å‹
interface Product {
  name: string;
  price: number;
}

function isProduct(value: any): value is Product {
  return (
    value != null &&
    typeof value.name === "string" &&
    typeof value.price === "number"
  );
}
```

ç±»å‹å®ˆå«è®©æˆ‘ä»¬èƒ½å¤Ÿå®‰å…¨åœ°å¤„ç† `unknown` ç±»å‹ï¼Œäº«å—ç±»å‹æ£€æŸ¥çš„å¥½å¤„ï¼ŒåŒæ—¶ä¿æŒæ¥æ”¶ä»»æ„ç±»å‹è¾“å…¥çš„çµæ´»æ€§ã€‚è¿™æ¯”ç›´æ¥ä½¿ç”¨ `any` ç±»å‹è¦å®‰å…¨å¾—å¤šï¼

#### unknown çš„é€‚ç”¨åœºæ™¯ ğŸ”

`unknown` é€‚åˆä»¥ä¸‹åœºæ™¯ï¼š

1. **å¤„ç† API å“åº”** - ä»å¤–éƒ¨è·å–çš„æ•°æ®ï¼Œç±»å‹ä¸ç¡®å®š
   ```ts
   async function fetchData(): Promise<unknown> {
     const response = await fetch('https://api.example.com/data');
     return response.json(); // è¿”å› unknown è€Œä¸æ˜¯ any
   }
   
   // å®‰å…¨åœ°ä½¿ç”¨è¿”å›ç»“æœ
   const data = await fetchData();
   if (typeof data === 'object' && data && 'users' in data) {
     // ç°åœ¨å¯ä»¥å®‰å…¨åœ°è®¿é—® data.users
   }
   ```

2. **å¤„ç†ç”¨æˆ·è¾“å…¥** - ç”¨æˆ·å¯èƒ½è¾“å…¥ä»»ä½•å†…å®¹
3. **æ’ä»¶ç³»ç»Ÿ** - å½“ä½ ä¸çŸ¥é“æ’ä»¶ä¼šä¼ å…¥ä»€ä¹ˆç±»å‹çš„æ•°æ®
4. **ç±»å‹è½¬æ¢æ¡¥æ¢** - ä½œä¸ºä¸åŒç±»å‹ç³»ç»Ÿä¹‹é—´çš„æ¡¥æ¢

### never - æ°¸ä¸å­˜åœ¨çš„ç±»å‹ ğŸš«

`never` ç±»å‹è¡¨ç¤ºé‚£äº›æ°¸è¿œä¸ä¼šå‡ºç°çš„å€¼ã€‚å®ƒæ˜¯ç±»å‹ç³»ç»Ÿä¸­çš„"å¹½çµ" ğŸ‘»ï¼Œä¾‹å¦‚åœ¨è”åˆç±»å‹ä¸­ï¼Œå®ƒä¼šç›´æ¥æ¶ˆå¤±ï¼š

```ts
type UnionWithNever = "hello" | 123 | true | void | never;
```

å¦‚æœä½ æŠŠé¼ æ ‡æ”¾åœ¨è¿™ä¸ªç±»å‹ä¸Šï¼Œä½ ä¼šå‘ç°æ˜¾ç¤ºçš„åªæœ‰ `"hello" | 123 | true | void`ï¼Œ`never` ç±»å‹ä¸è§äº†ï¼è¿™æ˜¯å› ä¸º `void` è¡¨ç¤º"ç©ºç±»å‹"ï¼Œå°±åƒå‡½æ•°ä¸è¿”å›å€¼æ—¶çš„ç±»å‹ï¼›è€Œ `never` åˆ™æ˜¯"ä»€ä¹ˆéƒ½æ²¡æœ‰"çš„ç±»å‹ï¼Œå®ƒè¿"ç©º"éƒ½ä¸æ˜¯ã€‚

å…³äºç±»å‹å…¼å®¹æ€§ï¼š

```ts
declare let v1: never;
declare let v2: void;

v1 = v2; // âŒ æŠ¥é”™ï¼švoid ä¸èƒ½èµ‹ç»™ never
v2 = v1; // âœ… å¯ä»¥ï¼šnever å¯ä»¥èµ‹ç»™ä»»ä½•ç±»å‹
```

åœ¨ç±»å‹ä½“ç³»ä¸­ï¼Œ`never` è¢«ç§°ä¸º **Bottom Type**ï¼Œæ˜¯æ•´ä¸ªç±»å‹ç³»ç»Ÿæœ€åº•å±‚çš„ç±»å‹ã€‚å®ƒæ˜¯æ‰€æœ‰ç±»å‹çš„å­ç±»å‹ï¼Œä½†åªæœ‰ `never` ç±»å‹çš„å€¼æ‰èƒ½èµ‹ç»™ `never` ç±»å‹çš„å˜é‡ã€‚

#### never çš„å®é™…åº”ç”¨ ğŸ”§

`never` çš„å¸¸è§ç”¨é€”ä¹‹ä¸€æ˜¯è¡¨ç¤ºé‚£äº›æ°¸è¿œä¸ä¼šæ­£å¸¸è¿”å›çš„å‡½æ•°ï¼š

```ts
function throwError(): never {
  throw new Error("å‡ºé”™å•¦ï¼ğŸ’¥");
}

function infiniteLoop(): never {
  while (true) {
    console.log("æˆ‘æ°¸è¿œä¸ä¼šåœä¸‹æ¥ ğŸ”„");
  }
}
```

`never` è¿˜å¯ä»¥ç”¨æ¥åšç©·å°½æ€§æ£€æŸ¥ï¼Œç¡®ä¿ä½ å¤„ç†äº†æ‰€æœ‰å¯èƒ½çš„æƒ…å†µï¼š

```ts
type Shape = Circle | Square;

function getArea(shape: Shape) {
  switch (shape.kind) {
    case "circle":
      return Math.PI * shape.radius ** 2;
    case "square":
      return shape.size ** 2;
    default:
      // å¦‚æœ Shape æ–°å¢äº†æˆå‘˜ä½†å¿˜äº†å¤„ç†ï¼Œè¿™é‡Œä¼šæŠ¥é”™ ğŸš¨
      const exhaustiveCheck: never = shape;
      return exhaustiveCheck;
  }
}
```

ä¸å¯èƒ½çŠ¶æ€æ ‡è®°ï¼š

```ts
function processEvent(event: 'click' | 'scroll' | 'mousemove') {
  if (event === 'click') {
    // å¤„ç†ç‚¹å‡»
  } else if (event === 'scroll') {
    // å¤„ç†æ»šåŠ¨
  } else if (event === 'mousemove') {
    // å¤„ç†é¼ æ ‡ç§»åŠ¨
  } else {
    // å¦‚æœå‰é¢çš„æ¡ä»¶è¦†ç›–äº†æ‰€æœ‰å¯èƒ½æ€§ï¼Œè¿™é‡Œæ°¸è¿œä¸ä¼šæ‰§è¡Œ
    const exhaustiveCheck: never = event;
  }
}
```

æœ‰æ—¶ä½ ä¼šæ— æ„ä¸­é‡åˆ° `never`ï¼Œä¾‹å¦‚ï¼š

```ts
const arr = [];

arr.push("hello"); // âŒ ç±»å‹"string"çš„å‚æ•°ä¸èƒ½èµ‹ç»™ç±»å‹"never"çš„å‚æ•°
```

è¿™é‡Œç©ºæ•°ç»„è¢«æ¨å¯¼ä¸º `never[]` ç±»å‹ã€‚è§£å†³æ–¹æ³•å¾ˆç®€å•ï¼šç»™æ•°ç»„å£°æ˜ä¸€ä¸ªå…·ä½“ç±»å‹å°±å¥½äº† ğŸ‘ã€‚

#### ç±»å‹è¿ç®—ä¸­çš„ never ç±»å‹ ğŸ§®

`never` åœ¨ TypeScript çš„ç±»å‹è¿ç®—ä¸­æ‰®æ¼”ç€é‡è¦è§’è‰²ï¼Œå°¤å…¶æ˜¯åœ¨æ„å»ºé«˜çº§ç±»å‹æ—¶ã€‚è¿™å°±åƒé­”æ³•å¸ˆçš„å·¥å…·ç®±é‡Œçš„ç§˜å¯†æ­¦å™¨ï¼Œèƒ½å¤Ÿå¸®ä½ å®ç°å¾ˆå¤šå¤æ‚çš„ç±»å‹æ“ä½œï¼š

##### äº¤å‰ç±»å‹ä¸ never

TypeScript ä¸­äº¤å‰ç±»å‹ï¼ˆç”¨ `&` è¿æ¥ï¼‰è¡¨ç¤ºåŒæ—¶æ»¡è¶³å¤šä¸ªç±»å‹ã€‚ä½†æœ‰äº›ç±»å‹ä¹‹é—´æ˜¯äº’æ–¥çš„ï¼Œäº¤å‰åä¼šå¾—åˆ° `never`ï¼š

```ts
// åŸå§‹ç±»å‹ä¹‹é—´æ˜¯äº’æ–¥çš„
type ImpossibleType = number & string; // never

// æœ‰äº’æ–¥å±æ€§çš„å¯¹è±¡ç±»å‹
type A = { type: 'a', valueA: string };
type B = { type: 'b', valueB: number };
type Intersection = A & B; // åŒ…å«äº’ç›¸å†²çªçš„ type å±æ€§

// ä½¿ç”¨äº’æ–¥çš„äº¤å‰ç±»å‹
const impossible: Intersection = {
  type: 'a', // âŒ æ— æ³•åŒæ—¶æ»¡è¶³ 'a' å’Œ 'b'
  valueA: 'hello',
  valueB: 123
};
```

è¿™ç§æƒ…å†µä¸‹ï¼ŒIDE å¯èƒ½ä¼šæ˜¾ç¤ºå¥‡æ€ªçš„é”™è¯¯ï¼Œè¡¨æ˜è¿™ä¸ªç±»å‹æ— æ³•å®ä¾‹åŒ–ï¼Œå› ä¸ºæŸäº›å±æ€§æœ‰å†²çªçš„è¦æ±‚ï¼Œå®é™…ä¸Šå°±æ˜¯ `never` çš„è¡¨ç°ã€‚

##### æ¡ä»¶ç±»å‹ä¸­çš„è¿‡æ»¤å™¨ ğŸ§¹

`never` åœ¨æ¡ä»¶ç±»å‹ä¸­å¸¸ç”¨ä½œ"è¿‡æ»¤å™¨"ï¼Œå¯ä»¥ä»è”åˆç±»å‹ä¸­å‰”é™¤æ‰æŸäº›ç±»å‹ï¼š

```ts
// TypeScript å†…ç½®çš„ Exclude ç±»å‹å®ç°
type Exclude<T, U> = T extends U ? never : T;

// ä½¿ç”¨ç¤ºä¾‹
type Animals = 'cat' | 'dog' | 'fish' | 'bird';
type Mammals = 'cat' | 'dog';
type NonMammals = Exclude<Animals, Mammals>; // 'fish' | 'bird'

// è‡ªå®šä¹‰ï¼šç§»é™¤æ•°ç»„ä¸­çš„æ‰€æœ‰ç©ºå€¼ç±»å‹
type NonNullable<T> = T extends null | undefined ? never : T;
type Types = string | number | null | undefined;
type NonNullTypes = NonNullable<Types>; // string | number
```

##### æå–ä¸æ’é™¤ç±»å‹ ğŸ”

ä½¿ç”¨ `never` é…åˆæ¡ä»¶ç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥æ„å»ºå‡ºæå–æˆ–æ’é™¤ç‰¹å®šå±æ€§çš„å·¥å…·ç±»å‹ï¼š

```ts
// æå–å¯¹è±¡ä¸­ç‰¹å®šç±»å‹çš„å±æ€§é”®
type ExtractPropertyKeys<T, U> = {
  [K in keyof T]: T[K] extends U ? K : never
}[keyof T];

// ä½¿ç”¨ç¤ºä¾‹
interface Person {
  name: string;
  age: number;
  isActive: boolean;
  updateInfo: () => void;
}

// æå– Person ä¸­æ‰€æœ‰å‡½æ•°ç±»å‹çš„å±æ€§é”®
type FunctionKeys = ExtractPropertyKeys<Person, Function>; // "updateInfo"

// æå– Person ä¸­æ‰€æœ‰åŸå§‹ç±»å‹çš„å±æ€§é”®
type PrimitiveKeys = ExtractPropertyKeys<Person, string | number | boolean>; // "name" | "age" | "isActive"
```

##### åˆ†å¸ƒå¼æ¡ä»¶ç±»å‹ ğŸ“Š

`never` åœ¨åˆ†å¸ƒå¼æ¡ä»¶ç±»å‹ä¸­ç‰¹åˆ«æœ‰ç”¨ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬å¤„ç†è”åˆç±»å‹ï¼š

```ts
// ä»è”åˆç±»å‹ T ä¸­ç§»é™¤ void
type RemoveVoid<T> = T extends void ? never : T;

// åº”ç”¨åˆ°è”åˆç±»å‹ä¸Šï¼Œä¼šè‡ªåŠ¨åˆ†å¸ƒå¤„ç†
type Result = RemoveVoid<string | number | void>; // string | number

// ä¸€ä¸ªæ›´å¤æ‚çš„ä¾‹å­ï¼šæå–å¯¹è±¡ç±»å‹çš„å¯é€‰é”®
type OptionalKeys<T> = {
  [K in keyof T]: {} extends Pick<T, K> ? K : never
}[keyof T];

interface User {
  id: number;
  name: string;
  email?: string;
  avatar?: string;
}

type UserOptionalKeys = OptionalKeys<User>; // "email" | "avatar"
```

##### æ„å»ºæ›´å®‰å…¨çš„ç±»å‹å·¥å…· ğŸ”’

åœ¨æ„å»ºå¤æ‚çš„ç±»å‹å·¥å…·æ—¶ï¼Œ`never` å¯ä»¥å¸®åŠ©æˆ‘ä»¬å¤„ç†è¾¹ç¼˜æƒ…å†µï¼š

```ts
// ä¸€ä¸ªç¡®ä¿å¯¹è±¡å…·æœ‰ä¸”ä»…å…·æœ‰ç‰¹å®šé”®çš„ç±»å‹å·¥å…·
type StrictObject<T, K extends keyof any> = {
  [P in K]: P extends keyof T ? T[P] : never
} & { [P in Exclude<keyof T, K>]?: never };

interface Config {
  port: number;
  host: string;
}

// åªå…è®¸ "port" å’Œ "host" å±æ€§
function startServer(config: StrictObject<Config, 'port' | 'host'>) {
  // ...
}

startServer({ port: 8080, host: 'localhost' }); // âœ… æ­£ç¡®
startServer({ port: 8080, host: 'localhost', debug: true }); // âŒ é”™è¯¯ï¼šä¸å…è®¸é¢å¤–çš„ 'debug' å±æ€§
```

é€šè¿‡è¿™äº›ä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° `never` ç±»å‹åœ¨ç±»å‹ç³»ç»Ÿä¸­çš„å¼ºå¤§ä½œç”¨ã€‚å®ƒä¸ä»…å¯ä»¥è¡¨ç¤º"ä¸å¯èƒ½çš„å€¼"ï¼Œè¿˜å¯ä»¥ä½œä¸ºç±»å‹è¿ç®—çš„å…³é”®å·¥å…·ï¼Œå¸®åŠ©æˆ‘ä»¬æ„å»ºæ›´ç²¾ç¡®ã€æ›´å®‰å…¨çš„ç±»å‹å®šä¹‰ã€‚åœ¨ TypeScript çš„ç±»å‹ä½“æ“ä¸­ï¼Œ`never` å°±åƒæ˜¯æ— å½¢çš„é­”æ³•ï¼Œè®©ä¸å¯èƒ½å˜æˆå¯èƒ½ï¼âœ¨

## ç±»å‹æ–­è¨€ ğŸ”„

### åŸºæœ¬ç±»å‹æ–­è¨€

ç±»å‹æ–­è¨€å°±åƒæ˜¯ä½ å¯¹ TypeScript ç¼–è¯‘å™¨è¯´ï¼š"ç›¸ä¿¡æˆ‘ï¼Œæˆ‘çŸ¥é“æˆ‘åœ¨åšä»€ä¹ˆï¼" é€šè¿‡ç±»å‹æ–­è¨€ï¼Œä½ å¯ä»¥è¦†ç›– TypeScript çš„ç±»å‹æ¨å¯¼ï¼Œæ‰‹åŠ¨æŒ‡å®šä¸€ä¸ªå€¼çš„ç±»å‹ã€‚

```ts
let unknownVar: unknown;

// å‘Šè¯‰TSï¼š"ç›¸ä¿¡æˆ‘ï¼Œå®ƒæœ‰fooæ–¹æ³•ï¼" ğŸ’ª
(unknownVar as { foo: () => {} }).foo();
```

é™¤äº† `as` è¯­æ³•å¤–ï¼Œä½ è¿˜å¯ä»¥ç”¨å°–æ‹¬å· `<>` è¯­æ³•ï¼ˆä½†åœ¨ TSX æ–‡ä»¶ä¸­å¯èƒ½ä¼šæœ‰å†²çªï¼‰ï¼š

```ts
// å°–æ‹¬å·è¯­æ³•
(<{ foo: () => {} }>unknownVar).foo();
```

### ç±»å‹æ–­è¨€ vs ç±»å‹è½¬æ¢ âš–ï¸

è¿™æ˜¯ä¸ªå®¹æ˜“æ··æ·†çš„æ¦‚å¿µï¼**ç±»å‹æ–­è¨€ä¸æ˜¯ç±»å‹è½¬æ¢**ï¼Œå®ƒä»¬æœ‰æœ¬è´¨åŒºåˆ«ï¼š

```ts
// ç±»å‹æ–­è¨€ï¼šåªåœ¨ç¼–è¯‘æ—¶å­˜åœ¨ï¼Œè¿è¡Œæ—¶ä¸ä¼šæœ‰ä»»ä½•æ•ˆæœ
const value: unknown = "123";
const length: number = (value as string).length; // âœ… ç¼–è¯‘é€šè¿‡

// ç±»å‹è½¬æ¢ï¼šå®é™…åœ¨è¿è¡Œæ—¶è½¬æ¢å€¼çš„ç±»å‹
const value = "123";
const num = Number(value); // 123ï¼Œå®é™…è½¬æ¢ä¸ºæ•°å­—
```

ç±»å‹æ–­è¨€å¥½æ¯”å‘Šè¯‰ç¼–è¯‘å™¨"ç›¸ä¿¡æˆ‘çš„åˆ¤æ–­"ï¼Œè€Œç±»å‹è½¬æ¢æ˜¯çœŸçš„æŠŠä¸€ä¸ªå€¼å˜æˆå¦ä¸€ç§ç±»å‹ã€‚å…³é”®åŒºåˆ«ï¼š

- **ç±»å‹æ–­è¨€**ï¼šåªå‘ç”Ÿåœ¨ç¼–è¯‘é˜¶æ®µï¼Œè¿è¡Œæ—¶æ— ç—•è¿¹ï¼Œä¸æ”¹å˜ JavaScript è¾“å‡º
- **ç±»å‹è½¬æ¢**ï¼šå‘ç”Ÿåœ¨è¿è¡Œæ—¶ï¼Œä¼šå¯¼è‡´å®é™…çš„ JavaScript è¡Œä¸ºå˜åŒ–

è®°ä½ï¼Œç±»å‹æ–­è¨€åº”å½“æ˜¯ä¸‡ä¸å¾—å·²æ—¶ä½¿ç”¨çš„æ‹›æ•°ã€‚å°±åƒåƒè¯ä¸€æ ·ï¼Œèƒ½ä¸ç”¨å°½é‡ä¸ç”¨ã€‚TypeScript çš„ç±»å‹æ¨å¯¼åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹å·²ç»å¤Ÿèªæ˜äº†ã€‚

### åŒé‡æ–­è¨€ - æ–­è¨€çš„å¥—å¨ƒ ğŸª†

å¦‚æœåŸç±»å‹å’Œæ–­è¨€ç±»å‹å·®å¤ªå¤šï¼ŒTypeScript ä¼šæé†’ä½ å¯èƒ½å‡ºé”™ï¼š

```ts
const str: string = "ä½ å¥½";

// âŒ æŠ¥é”™ï¼šä»stringåˆ°å¸¦handleræ–¹æ³•çš„å¯¹è±¡ï¼Œå·®å¤ªè¿œäº†å§ï¼Ÿ
(str as { handler: () => {} }).handler();
```

æ­¤æ—¶éœ€è¦å…ˆæ–­è¨€åˆ° `unknown` æˆ– `any`ï¼Œå†æ–­è¨€åˆ°ç›®æ ‡ç±»å‹ï¼š

```ts
const str: string = "ä½ å¥½";

// åŒé‡æ–­è¨€ï¼šå…ˆå˜æˆunknownï¼Œå†å˜æˆç›®æ ‡ç±»å‹ ğŸ”„
(str as unknown as { handler: () => {} }).handler();

// ä½¿ç”¨å°–æ‹¬å·ä¹Ÿå¯ä»¥
(<{ handler: () => {} }>(<unknown>str)).handler();
```

è¿™å°±åƒæ˜¯å…ˆæŠŠä¸œè¥¿å˜æˆä¸€å›¢æ³¥å·´ï¼ˆ`unknown`ï¼‰ï¼Œå†ææˆä½ æƒ³è¦çš„å½¢çŠ¶ã€‚

### éç©ºæ–­è¨€ - "å®ƒç»å¯¹æœ‰å€¼ï¼" âš¡

éç©ºæ–­è¨€ä½¿ç”¨ `!` ç¬¦å·ï¼Œè¡¨ç¤ºæŸä¸ªå€¼ä¸€å®šä¸æ˜¯ `null` æˆ– `undefined`ï¼š

```ts
declare const foo: {
  func?: () => {
    prop?: number | null;
  };
};

// âŒ æŠ¥é”™ï¼šfuncå¯èƒ½ä¸å­˜åœ¨ï¼Œpropå¯èƒ½ä¸ºnull
foo.func().prop.toFixed();

// âœ… ä½¿ç”¨éç©ºæ–­è¨€ï¼šæˆ‘ä¿è¯å®ƒä»¬å­˜åœ¨ï¼
foo.func!().prop!.toFixed();
```

æ³¨æ„ï¼Œéç©ºæ–­è¨€åªæ˜¯æ¶ˆé™¤äº†ç±»å‹æ£€æŸ¥é”™è¯¯ï¼Œè¿è¡Œæ—¶å¦‚æœçœŸçš„æ˜¯ `null`ï¼Œè¿˜æ˜¯ä¼šç‚¸çš„ ğŸ’£ã€‚æ¯”èµ·éç©ºæ–­è¨€ï¼Œå¯é€‰é“¾ï¼ˆ`?.`ï¼‰é€šå¸¸æ˜¯æ›´å®‰å…¨çš„é€‰æ‹©ã€‚

éç©ºæ–­è¨€å…¶å®æ˜¯ç±»å‹æ–­è¨€çš„ç®€å†™ï¼Œç›¸å½“äºï¼š

```ts
(
  (
    foo.func as () => {
      prop?: number;
    }
  )().prop as number
).toFixed();
```

### const æ–­è¨€ - è®©å€¼æ›´"ç¡¬" ğŸ”’

TypeScript 3.4 å¼•å…¥çš„ `as const` è¯­æ³•å¯ä»¥å°†è¡¨è¾¾å¼çš„ç±»å‹å˜å¾—æ›´ç²¾ç¡®ï¼š

```ts
// æ²¡æœ‰as constæ—¶ï¼šç±»å‹ä¸º { x: number, y: number }
const point = { x: 10, y: 20 };

// ä½¿ç”¨as constï¼šç±»å‹ä¸º { readonly x: 10, readonly y: 20 }
const pointExact = { x: 10, y: 20 } as const;

// æ™®é€šæ•°ç»„ï¼šstring[]
const arr = ["a", "b", "c"];

// ä½¿ç”¨as constï¼šreadonly ["a", "b", "c"]ï¼Œå˜æˆäº†å…ƒç»„
const tupleArr = ["a", "b", "c"] as const;
```

`as const` åœ¨å¤„ç†ä¸å¯å˜æ•°æ®ã€å­—é¢é‡ç±»å‹å’Œå…ƒç»„æ—¶ç‰¹åˆ«æœ‰ç”¨ï¼Œè®©ä½ çš„ç±»å‹æ›´ç²¾ç¡®ï¼Œä»£ç æ›´å®‰å…¨ã€‚ğŸ”

### æ–­è¨€ä½œä¸ºç±»å‹æç¤º ğŸ“

ç±»å‹æ–­è¨€è¿˜æœ‰ä¸ªå®ç”¨åŠŸèƒ½ï¼šå¸®åŠ©ä½ åœ¨å®ç°å¤æ‚æ¥å£æ—¶å·æ‡’ ğŸ˜‰ï¼š

```ts
interface IStruct {
  foo: string;
  bar: {
    barPropA: string;
    barPropB: number;
    barMethod: () => void;
    baz: {
      handler: () => Promise<void>;
    };
  };
}

// âŒ å¦‚æœç›´æ¥è¿™æ ·å†™ï¼Œè¦å®ç°æ‰€æœ‰å±æ€§ï¼Œå¤ªéº»çƒ¦äº†
const obj: IStruct = {}; // æŠ¥é”™

// âœ… ä½¿ç”¨ç±»å‹æ–­è¨€ï¼Œå¯ä»¥åªå®ç°éƒ¨åˆ†ç»“æ„ï¼Œè¿˜èƒ½ä¿ç•™ç±»å‹æç¤º
const obj = <IStruct>{
  bar: {
    baz: {},
  },
};
```

## æœ€ä½³å®è·µ - TypeScripté«˜æ‰‹æŒ‡å— ğŸ†

1. å°½é‡é¿å… `any`ï¼Œä¼˜å…ˆç”¨ `unknown` åŠ ç±»å‹å®ˆå« ğŸ›¡ï¸
2. ç±»å‹æ–­è¨€åªåœ¨ç¡®å®éœ€è¦æ—¶ä½¿ç”¨ï¼Œä¸è¦æ»¥ç”¨ âš ï¸
3. ç”¨ `never` ç±»å‹åšç©·å°½æ€§æ£€æŸ¥ï¼Œæé«˜ä»£ç å¥å£®æ€§ ğŸ’ª
4. å¼€å¯ `noImplicitAny` å’Œ `strictNullChecks` é…ç½®ï¼Œè®©TSä¿æŠ¤ä½  ğŸ”’
5. ä½¿ç”¨ `as const` æ–­è¨€åˆ›å»ºç²¾ç¡®çš„åªè¯»ç±»å‹ ğŸ“Œ
6. äº†è§£å¹¶åˆ©ç”¨ TypeScript çš„ç±»å‹è¿ç®—èƒ½åŠ›ï¼Œæ„å»ºæ›´ç²¾ç¡®çš„ç±»å‹ ğŸ§®
7. è®°ä½ï¼šç±»å‹ç³»ç»Ÿæ˜¯ä½ çš„æœ‹å‹ï¼Œä¸æ˜¯æ•Œäººï¼ä¸å®ƒåˆä½œï¼Œä¸è¦å¯¹æŠ—å®ƒ ğŸ¤
